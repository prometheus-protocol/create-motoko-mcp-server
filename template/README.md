# My Awesome MCP Server

This project was generated by `create-motoko-mcp-server` and provides a complete, ready-to-deploy Motoko MCP server for the [Prometheus Protocol](https://github.com/prometheus-protocol/prometheus-protocol) ecosystem.

This guide assumes you are using `npm` as your package manager.

## Prerequisites

Before you begin, make sure you have the following tools installed on your system:

1.  **DFX:** The DFINITY Canister SDK. [Installation Guide](https://dfinity.org/developers).
2.  **Node.js:** Version 18.0 or higher. [Download](https://nodejs.org/).
3.  **MOPS:** The Motoko Package Manager. [Installation Guide](https://mops.one/docs/install).

---

## Part 1: Quick Start

This section guides you from zero to a working, testable MCP server in minutes.

### Step 1: Install Dependencies

This command will install both the required Node.js packages and the Motoko packages.

```bash
npm install
npm run mops:install
```

### Step 2: Deploy Your Server Locally

1.  **Start the Local Replica:**
    ```bash
    npm run start
    ```
2.  **Deploy to the Local Replica:** (In a new terminal window)
    **MODIFIED:** Your canister now requires initialization arguments for ownership and payments.
    ```bash
    npm run deploy
    ```
    *This script automatically provides default arguments for local deployment. You can edit them in `package.json`.*

### Step 3: Test with the MCP Inspector

Your server is live and its default `get_weather` tool is ready to use.

1.  **Launch the Inspector:**
    ```bash
    npm run inspector
    ```
2.  **Connect to Your Canister:** Use the local canister ID endpoint provided in the `dfx deploy` output.
    ```
    # Replace `your_canister_id` with the actual ID from the deploy output
    http://127.0.0.1:4943/mcp/?canisterId=your_canister_id
    ```
ðŸŽ‰ **Congratulations!** You have a working MCP server.

---

## Part 2: Enable Monetization

Ready to add paid tools? Follow these steps.

### Step 1: Configure Your Paid Tool

1.  Open `src/main.mo`.
2.  Find the `tools` array and uncomment the `payment` block inside the `get_weather` tool definition.
3.  Uncomment the `allowanceUrl` in the `mcpConfig` to provide users with a link to manage their token allowances. If you're using the Prometheus Auth Server, you can use: `https://bmfnl-jqaaa-aaaai-q32ha-cai.icp0.io/`

### Step 2: Enable Authentication

Paid tools require authentication to identify the paying user.

1.  In `src/main.mo`, uncomment the large block of code that initializes the `authContext`.
2.  Save the file.
3.  Run `npm run deploy` again to update your canister with the new logic.

Your server's tools are now protected and require a valid token to be called.

### Step 3: Register with the Auth Server

Use the built-in `auth` script to interact with the Prometheus Auth Server.

1.  **Register Your Server:** This command registers your application as a client.
    ```bash
    npm run auth register
    ```

*Tip: See all available commands by running `npm run auth -- --help`.*

---

## Part 3: Treasury Management

Your canister includes built-in Treasury functions to securely manage the funds it collects.

-   **`get_owner()`**: View the canister's owner.
-   **`set_owner(new_owner)`**: Transfer ownership (owner only).
-   **`get_treasury_balance(ledger_id)`**: Check the canister's balance of any ICRC-1 token.
-   **`withdraw(ledger_id, amount, destination)`**: Withdraw funds to any account (owner only).

You can call these functions using `dfx`. For example, to check the canister's balance:
```bash
# Replace `your_ledger_id` with the ICRC-1 ledger canister ID
dfx canister call my_awesome_mcp_server get_treasury_balance '(principal "your_ledger_id")'
```

---

## Part 4: Publish to the Prometheus App Store

*(This section remains the same)*

---

## Deploying to Production

1.  **Deploy to the IC Mainnet:**
    **MODIFIED:** You must provide your mainnet owner principal and the target ledger ID.
    ```bash
    # Replace the placeholder principals with your real mainnet values
    npm run deploy:ic -- --argument '(record { owner = principal "your-mainnet-principal"; paymentLedger = principal "mxzaz-hqaaa-aaaar-qaada-cai" })'
    ```

2.  **Update OAuth Redirect URI:** **(Important!)** If you enabled monetization, you must run `npm run auth update` again and change the `redirect_uri` to your production URL.
    ```
    # Example Production Canister URL
    https://your_canister_id.icp0.io/
    ```

## What's Next?

-   **Customize Your Tool:** Open `src/main.mo` to start building your own custom MCP tools.
-   **Learn More:** Check out the [Motoko MCP SDK documentation](https://github.com/prometheus-protocol/motoko-sdk) for advanced features.